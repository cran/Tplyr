<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Creating Custom Tplyr Metadata</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Creating Custom Tplyr Metadata</h1>


<div id="TOC">
<ul>
<li><a href="#build-a-tplyr_meta-object" id="toc-build-a-tplyr_meta-object">Build a <code>tplyr_meta</code>
object</a></li>
<li><a href="#building-your-own-metadata-table" id="toc-building-your-own-metadata-table">Building your own metadata
table</a></li>
<li><a href="#appending-existing-tplyr-metadata" id="toc-appending-existing-tplyr-metadata">Appending Existing
<strong>Tplyr</strong> Metadata</a></li>
<li><a href="#metadata-without-tplyr" id="toc-metadata-without-tplyr">Metadata Without Tplyr</a></li>
<li><a href="#tying-it-together" id="toc-tying-it-together">Tying it
Together</a></li>
</ul>
</div>

<p>As covered in
<code>vignette(&#39;metadata&#39;)</code>,<strong>Tplyr</strong> can produce
metadata for any result that it calculates. But what about data that
<strong>Tplyr</strong> can’t produce, such as a efficacy results or some
sort of custom analysis? You may still want that drill down capability
either on your own or paired with an existing <strong>Tplyr</strong>
table.</p>
<p>Take for instance Table 14-3.01 from the <a href="https://github.com/atorus-research/CDISC_pilot_replication">CDISC
Pilot</a>. Skipping the actual construction of the table, here’s the
output data from <strong>Tplyr</strong> and some manual calculation:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">kable</span>(full_data)</span></code></pre></div>
<table>
<colgroup>
<col width="5%" />
<col width="28%" />
<col width="12%" />
<col width="11%" />
<col width="20%" />
<col width="21%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">row_id</th>
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="left">var1_Xanomeline High Dose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">d1_1</td>
<td align="left">Baseline</td>
<td align="left">n</td>
<td align="left">79</td>
<td align="left">81</td>
<td align="left">74</td>
</tr>
<tr class="even">
<td align="left">d2_1</td>
<td align="left"></td>
<td align="left">Mean (SD)</td>
<td align="left">24.1 (12.19)</td>
<td align="left">24.4 (12.92)</td>
<td align="left">21.3 (11.74)</td>
</tr>
<tr class="odd">
<td align="left">d3_1</td>
<td align="left"></td>
<td align="left">Median (Range)</td>
<td align="left">21.0 ( 5;61)</td>
<td align="left">21.0 ( 5;57)</td>
<td align="left">18.0 ( 3;57)</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">d1_2</td>
<td align="left">Week 24</td>
<td align="left">n</td>
<td align="left">79</td>
<td align="left">81</td>
<td align="left">74</td>
</tr>
<tr class="even">
<td align="left">d2_2</td>
<td align="left"></td>
<td align="left">Mean (SD)</td>
<td align="left">26.7 (13.79)</td>
<td align="left">26.4 (13.18)</td>
<td align="left">22.8 (12.48)</td>
</tr>
<tr class="odd">
<td align="left">d3_2</td>
<td align="left"></td>
<td align="left">Median (Range)</td>
<td align="left">24.0 ( 5;62)</td>
<td align="left">25.0 ( 6;62)</td>
<td align="left">20.0 ( 3;62)</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">d1_3</td>
<td align="left">Change from Baseline</td>
<td align="left">n</td>
<td align="left">79</td>
<td align="left">81</td>
<td align="left">74</td>
</tr>
<tr class="even">
<td align="left">d2_3</td>
<td align="left"></td>
<td align="left">Mean (SD)</td>
<td align="left">2.5 ( 5.80)</td>
<td align="left">2.0 ( 5.55)</td>
<td align="left">1.5 ( 4.26)</td>
</tr>
<tr class="odd">
<td align="left">d3_3</td>
<td align="left"></td>
<td align="left">Median (Range)</td>
<td align="left">2.0 (-11;16)</td>
<td align="left">2.0 (-11;17)</td>
<td align="left">1.0 ( -7;13)</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">x4_1</td>
<td align="left">p-value(Dose Response) [1][2]</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">0.245</td>
</tr>
<tr class="even">
<td align="left">x4_2</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">x4_3</td>
<td align="left">p-value(Xan - Placebo) [1][3]</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">0.569</td>
<td align="left">0.233</td>
</tr>
<tr class="even">
<td align="left">x4_4</td>
<td align="left">Diff of LS Means (SE)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">-0.5 (0.82)</td>
<td align="left">-1.0 (0.84)</td>
</tr>
<tr class="odd">
<td align="left">x4_5</td>
<td align="left">95% CI</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">(-2.1;1.1)</td>
<td align="left">(-2.7;0.7)</td>
</tr>
<tr class="even">
<td align="left">x4_6</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">x4_7</td>
<td align="left">p-value(Xan High - Xan Low) [1][3]</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">0.520</td>
</tr>
<tr class="even">
<td align="left">x4_8</td>
<td align="left">Diff of LS Means (SE)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">-0.5 (0.84)</td>
</tr>
<tr class="odd">
<td align="left">x4_9</td>
<td align="left">95% CI</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">(-2.2;1.1)</td>
</tr>
</tbody>
</table>
<p>This is the primary efficacy table from the trial. The top portion of
this table is fairly straightforward with <strong>Tplyr</strong> and can
be done using descriptive statistic layers. Once you hit the p-values on
the lower house, this becomes beyond Tplyr’s remit. To produce the
table, you can combine <strong>Tplyr</strong> output with a separate
data frame analyzed and formatted yourself (but note you can still use
some help from <strong>Tplyr</strong> tools like
<code>apply_formats()</code>).</p>
<p>But what about the metadata? How do you get the drill down
capabilities for that lower half of the table? We’ve provided a couple
additional tools in <strong>Tplyr</strong> to allow you to construct
your own metadata and append existing metadata present in a
<strong>Tplyr</strong> table.</p>
<div id="build-a-tplyr_meta-object" class="section level2">
<h2>Build a <code>tplyr_meta</code> object</h2>
<p>As covered in <code>vignette(&#39;metadata&#39;)</code>, a
<code>tplyr_meta</code> object consists of two different fields: A list
of variable names, and a list of filter conditions. You provide both of
these fields as a list of quosures:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">tplyr_meta</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="at">names =</span> <span class="fu">quos</span>(a, b, c),</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="at">filters =</span> <span class="fu">quos</span>(a<span class="sc">==</span><span class="dv">1</span>, b<span class="sc">==</span><span class="dv">2</span>, c<span class="sc">==</span><span class="dv">3</span>)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>m</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; tplyr_meta: 3 names, 3 filters</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt; Names:</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt;     a, b, c </span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt; Filters:</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt;     a == 1, b == 2, c == 3</span></span></code></pre></div>
<p>The <code>tplyr_meta()</code> function can take these fields
immediately upon creation. If you need to dynamically create a
<code>tplyr_meta</code> object such as how <strong>Tplyr</strong>
constructs the objects internally), the functions
<code>add_variables()</code> and <code>add_filters()</code> are
available to extend an existing <code>tplyr_meta</code> object:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> m <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="fu">add_variables</span>(<span class="fu">quos</span>(x)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="fu">add_filters</span>(<span class="fu">quos</span>(x <span class="sc">==</span> <span class="st">&#39;a&#39;</span>))</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>m</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; tplyr_meta: 4 names, 4 filters</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; Names:</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt;     a, b, c, x </span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; Filters:</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt;     a == 1, b == 2, c == 3, x == &quot;a&quot;</span></span></code></pre></div>
</div>
<div id="building-your-own-metadata-table" class="section level2">
<h2>Building your own metadata table</h2>
<p>Now that we can create our own <code>tplyr_meta</code> objects, let’s
assemble the metadata for the bottom portion of Table 14-3.01:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Overall model subset of data</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>meta <span class="ot">&lt;-</span> <span class="fu">tplyr_meta</span>(</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="at">names =</span> <span class="fu">quos</span>(TRTP, EFFFL, ITTFL, ANL01FL, SITEGR1, AVISIT, AVISITN, PARAMCD, AVAL, BASE, CHG),</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="at">filters =</span> <span class="fu">quos</span>(EFFFL <span class="sc">==</span> <span class="st">&quot;Y&quot;</span>, ITTFL <span class="sc">==</span> <span class="st">&quot;Y&quot;</span>, PARAMCD <span class="sc">==</span> <span class="st">&quot;ACTOT&quot;</span>, ANL01FL <span class="sc">==</span> <span class="st">&quot;Y&quot;</span>, AVISITN <span class="sc">==</span> <span class="dv">24</span>)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co"># Xan High / Placebo contrast</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>meta_xhp <span class="ot">&lt;-</span> meta <span class="sc">%&gt;%</span> </span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  <span class="fu">add_filters</span>(<span class="fu">quos</span>(TRTP <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Xanomeline High Dose&quot;</span>, <span class="st">&quot;Placebo&quot;</span>)))</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co"># Xan Low / Placbo Contrast</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>meta_xlp <span class="ot">&lt;-</span> meta <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>  <span class="fu">add_filters</span>(<span class="fu">quos</span>(TRTP <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Xanomeline Low Dose&quot;</span>, <span class="st">&quot;Placebo&quot;</span>)))</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co"># Xan High / Xan Low Contrast</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>meta_xlh <span class="ot">&lt;-</span> meta <span class="sc">%&gt;%</span> </span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>  <span class="fu">add_filters</span>(<span class="fu">quos</span>(TRTP <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Xanomeline High Dose&quot;</span>, <span class="st">&quot;Xanomeline Low Dose&quot;</span>)))</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>eff_meta <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>  <span class="sc">~</span><span class="st">&quot;row_id&quot;</span>,  <span class="sc">~</span><span class="st">&quot;row_label1&quot;</span>,                       <span class="sc">~</span><span class="st">&quot;var1_Xanomeline Low Dose&quot;</span>, <span class="sc">~</span><span class="st">&quot;var1_Xanomeline High Dose&quot;</span>,</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>  <span class="st">&quot;x4_1&quot;</span>,    <span class="st">&quot;p-value(Dose Response) [1][2]&quot;</span>,      <span class="cn">NULL</span>,                        meta,</span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>  <span class="st">&quot;x4_3&quot;</span>,    <span class="st">&quot;p-value(Xan - Placebo) [1][3]&quot;</span>,        meta_xlp,                    meta_xhp,</span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>  <span class="st">&quot;x4_4&quot;</span>,    <span class="st">&quot;   Diff of LS Means (SE)&quot;</span>,           meta_xlp,                    meta_xhp,</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>  <span class="st">&quot;x4_5&quot;</span>,    <span class="st">&quot;   95% CI&quot;</span>,                          meta_xlp,                    meta_xhp,</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>  <span class="st">&quot;x4_7&quot;</span>,    <span class="st">&quot;p-value(Xan High - Xan Low) [1][3]&quot;</span>, <span class="cn">NULL</span>,                        meta_xlh,</span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>  <span class="st">&quot;x4_8&quot;</span>,    <span class="st">&quot;   Diff of LS Means (SE)&quot;</span>,           <span class="cn">NULL</span>,                        meta_xlh,</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>  <span class="st">&quot;x4_9&quot;</span>,    <span class="st">&quot;   95% CI&quot;</span>,                          <span class="cn">NULL</span>,                        meta_xlh</span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>)</span></code></pre></div>
<p>Let’s break down what happened here:</p>
<ul>
<li>First, we assemble the the overarching metadata object for the
model. A lot of this metadata is shared across each of the different
result cells for all of the efficacy data, so we can start by collecting
this information into a <code>tplyr_meta</code> object.</li>
<li>Next, we can use that starting point to build
<code>tplyr_meta</code> objects for the other result cells. The model
data contains contrasts of each of the different treatment group
comparisons. By using <code>add_filters()</code>, we can create those
additional three <code>tplyr_meta</code> objects using the starting
point and attaching an additional filter condition.</li>
<li>Lastly, to extend the metadata in the original
<code>tplyr_table</code> object that created the summary portion of this
table, we need a data frame. There’s a lot of ways to do this, but I
like the display and explicitness of
<code>tibble::tribble()</code>.</li>
</ul>
<p>When building a data frame for use with <code>tplyr_table</code>
metadata, there are really only two rules:</p>
<ul>
<li>You need a column in the data frame called <code>row_id</code></li>
<li>The <code>row_id</code> values cannot be duplicates of any other
value within the existing metadata.</li>
</ul>
<p>The <code>row_id</code> values built by <strong>Tplyr</strong> will
always follow the format “<first letter of layer type>n_n”, where the
first letter of the layer type will either be “c”, “d”, or “s”. The next
number is the layer number (i.e. the order in which the layer was
inserted to the <strong>Tplyr</strong> table), and then finally the row
of that layer within the output. For example, the third row of a count
layer that was the second layer in the table would have a
<code>row_id</code> of “c2_3”. In this example, I chose “x4_n” as the
format for the “x” to symbolize custom, and these data can be thought of
as the fourth layer. That said, these values would typically be masked
by the viewer of the table so they really just need to be unique - so
you can choose whatever you want.</p>
</div>
<div id="appending-existing-tplyr-metadata" class="section level2">
<h2>Appending Existing <strong>Tplyr</strong> Metadata</h2>
<p>Now that we’ve created our custom extension of the
<strong>Tplyr</strong> metadata, let’s extend the existing data frame.
To do this, <strong>Tplyr</strong> has the function
<code>append_metadata()</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">append_metadata</span>(t, eff_meta)</span></code></pre></div>
<p>Behind the scenes, this function simply binds the new metadata with
the old in the proper section of the <code>tplyr_table</code> object.
You can view the the <code>tplyr_table</code> metadata with the function
<code>get_metadata()</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">get_metadata</span>(t)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt; # A tibble: 16 × 6</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt;    row_id row_label1              row_label2 var1_Placebo var1_Xanomeline High…¹</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt;                   &lt;chr&gt;      &lt;list&gt;       &lt;list&gt;                </span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt;  1 d1_1   &quot;Baseline&quot;              n          &lt;tplyr_mt&gt;   &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt;  2 d2_1   &quot;Baseline&quot;              Mean (SD)  &lt;tplyr_mt&gt;   &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt;  3 d3_1   &quot;Baseline&quot;              Median (R… &lt;tplyr_mt&gt;   &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt;  4 d1_2   &quot;Week 24&quot;               n          &lt;tplyr_mt&gt;   &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt;  5 d2_2   &quot;Week 24&quot;               Mean (SD)  &lt;tplyr_mt&gt;   &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt;  6 d3_2   &quot;Week 24&quot;               Median (R… &lt;tplyr_mt&gt;   &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt;  7 d1_3   &quot;Change from Baseline&quot;  n          &lt;tplyr_mt&gt;   &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt;  8 d2_3   &quot;Change from Baseline&quot;  Mean (SD)  &lt;tplyr_mt&gt;   &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt;  9 d3_3   &quot;Change from Baseline&quot;  Median (R… &lt;tplyr_mt&gt;   &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; 10 x4_1   &quot;p-value(Dose Response… &lt;NA&gt;       &lt;NULL&gt;       &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; 11 x4_3   &quot;p-value(Xan - Placebo… &lt;NA&gt;       &lt;NULL&gt;       &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; 12 x4_4   &quot;   Diff of LS Means (… &lt;NA&gt;       &lt;NULL&gt;       &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; 13 x4_5   &quot;   95% CI&quot;             &lt;NA&gt;       &lt;NULL&gt;       &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; 14 x4_7   &quot;p-value(Xan High - Xa… &lt;NA&gt;       &lt;NULL&gt;       &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; 15 x4_8   &quot;   Diff of LS Means (… &lt;NA&gt;       &lt;NULL&gt;       &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; 16 x4_9   &quot;   95% CI&quot;             &lt;NA&gt;       &lt;NULL&gt;       &lt;tplyr_mt&gt;            </span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co">#&gt; # ℹ abbreviated name: ¹​`var1_Xanomeline High Dose`</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="co">#&gt; # ℹ 1 more variable: `var1_Xanomeline Low Dose` &lt;list&gt;</span></span></code></pre></div>
<p>Finally, as with the automatically created metadata from Tplyr, we
can query these result cells just the same:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">get_meta_subset</span>(t, <span class="st">&#39;x4_1&#39;</span>, <span class="st">&quot;var1_Xanomeline High Dose&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="12%" />
<col width="21%" />
<col width="6%" />
<col width="6%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="5%" />
<col width="5%" />
<col width="4%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">TRTP</th>
<th align="left">EFFFL</th>
<th align="left">ITTFL</th>
<th align="left">ANL01FL</th>
<th align="left">SITEGR1</th>
<th align="left">AVISIT</th>
<th align="right">AVISITN</th>
<th align="left">PARAMCD</th>
<th align="right">AVAL</th>
<th align="right">BASE</th>
<th align="right">CHG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">Placebo</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">701</td>
<td align="left">Week 24</td>
<td align="right">24</td>
<td align="left">ACTOT</td>
<td align="right">8</td>
<td align="right">13</td>
<td align="right">-5</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">Placebo</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">701</td>
<td align="left">Week 24</td>
<td align="right">24</td>
<td align="left">ACTOT</td>
<td align="right">12</td>
<td align="right">13</td>
<td align="right">-1</td>
</tr>
<tr class="odd">
<td align="left">01-701-1028</td>
<td align="left">Xanomeline High Dose</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">701</td>
<td align="left">Week 24</td>
<td align="right">24</td>
<td align="left">ACTOT</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1033</td>
<td align="left">Xanomeline Low Dose</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">701</td>
<td align="left">Week 24</td>
<td align="right">24</td>
<td align="left">ACTOT</td>
<td align="right">7</td>
<td align="right">7</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">Xanomeline High Dose</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">701</td>
<td align="left">Week 24</td>
<td align="right">24</td>
<td align="left">ACTOT</td>
<td align="right">11</td>
<td align="right">11</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1047</td>
<td align="left">Placebo</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">701</td>
<td align="left">Week 24</td>
<td align="right">24</td>
<td align="left">ACTOT</td>
<td align="right">19</td>
<td align="right">10</td>
<td align="right">9</td>
</tr>
</tbody>
</table>
</div>
<div id="metadata-without-tplyr" class="section level2">
<h2>Metadata Without Tplyr</h2>
<p>You very well may have a scenario where you want to use these
metadata functions outside of <strong>Tplyr</strong> in general. As
such, there are S3 methods available to query metadata from a dataframe
instead of a <strong>Tplyr</strong> table, and parameters to provide
your own target data frame:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">get_meta_subset</span>(eff_meta, <span class="st">&#39;x4_1&#39;</span>, <span class="st">&quot;var1_Xanomeline High Dose&quot;</span>, <span class="at">target=</span>tplyr_adas) <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="12%" />
<col width="21%" />
<col width="6%" />
<col width="6%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="5%" />
<col width="5%" />
<col width="4%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">USUBJID</th>
<th align="left">TRTP</th>
<th align="left">EFFFL</th>
<th align="left">ITTFL</th>
<th align="left">ANL01FL</th>
<th align="left">SITEGR1</th>
<th align="left">AVISIT</th>
<th align="right">AVISITN</th>
<th align="left">PARAMCD</th>
<th align="right">AVAL</th>
<th align="right">BASE</th>
<th align="right">CHG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">Placebo</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">701</td>
<td align="left">Week 24</td>
<td align="right">24</td>
<td align="left">ACTOT</td>
<td align="right">8</td>
<td align="right">13</td>
<td align="right">-5</td>
</tr>
<tr class="even">
<td align="left">01-701-1023</td>
<td align="left">Placebo</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">701</td>
<td align="left">Week 24</td>
<td align="right">24</td>
<td align="left">ACTOT</td>
<td align="right">12</td>
<td align="right">13</td>
<td align="right">-1</td>
</tr>
<tr class="odd">
<td align="left">01-701-1028</td>
<td align="left">Xanomeline High Dose</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">701</td>
<td align="left">Week 24</td>
<td align="right">24</td>
<td align="left">ACTOT</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1033</td>
<td align="left">Xanomeline Low Dose</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">701</td>
<td align="left">Week 24</td>
<td align="right">24</td>
<td align="left">ACTOT</td>
<td align="right">7</td>
<td align="right">7</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">01-701-1034</td>
<td align="left">Xanomeline High Dose</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">701</td>
<td align="left">Week 24</td>
<td align="right">24</td>
<td align="left">ACTOT</td>
<td align="right">11</td>
<td align="right">11</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">01-701-1047</td>
<td align="left">Placebo</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">Y</td>
<td align="left">701</td>
<td align="left">Week 24</td>
<td align="right">24</td>
<td align="left">ACTOT</td>
<td align="right">19</td>
<td align="right">10</td>
<td align="right">9</td>
</tr>
</tbody>
</table>
<p>As with the <strong>Tplyr</strong> metadata, the only strict criteria
here is that your custom metadata have a <code>row_id</code> column.</p>
</div>
<div id="tying-it-together" class="section level2">
<h2>Tying it Together</h2>
<p>The vignette wouldn’t be complete without the final contextual
example - so here we go. Ultimately these pieces an all fit together in
the context of a Shiny application and give you the desired
click-through experience.</p>
<iframe src="https://michael-stackhouse.shinyapps.io/Tplyr-efficacy-shiny-demo?showcase=0" width="850" height="900px" data-external="1" style="border: 1px solid #464646;" allowfullscreen allow="autoplay">
</iframe>
<p><em>Source code available <a href="https://github.com/atorus-research/Tplyr-efficacy-shiny-demo">here</a></em></p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
