<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>General String Formatting</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">General String Formatting</h1>


<div id="TOC">
<ul>
<li><a href="#format-strings" id="toc-format-strings">Format
Strings</a></li>
<li><a href="#general-formatting" id="toc-general-formatting">General
Formatting</a></li>
<li><a href="#controlling-formatting" id="toc-controlling-formatting">Controlling Formatting</a>
<ul>
<li><a href="#lowercase-x" id="toc-lowercase-x">Lowercase ‘x’</a></li>
<li><a href="#uppercase-x" id="toc-uppercase-x">Uppercase ‘X’</a></li>
</ul></li>
<li><a href="#auto-precision" id="toc-auto-precision">Auto-precision</a></li>
</ul>
</div>

<p>A key focus of producing a clinical table is ensuring that the
formatting of the table is in line with the statistician and clinician’s
expectations. Organizations often have strict standards around this
which vary between organizations. Much of this falls outside the scope
of <strong>Tplyr</strong>, but <strong>Tplyr</strong> gives
<em>great</em> focus to how the numeric results on the page are
formatted. R has vast capabilities when it comes to HTML and interactive
tables, but <strong>Tplyr’s</strong> focus on string formatting is
designed for those traditional, PDF document printable pages. The aim to
make it as simple as possible to get what you need to work with a
typical monospace fonts.</p>
<p><em>Note: We’ve still focused on R’s interactive capabilities, so be
sure to check out <code>vignette(&quot;metadata&quot;)</code></em></p>
<div id="format-strings" class="section level2">
<h2>Format Strings</h2>
<p>Regardless of what layer type you use within <strong>Tplyr</strong>,
control of formatting is handled by using format strings. Consider the
following example.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">tplyr_table</span>(tplyr_adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    <span class="fu">group_count</span>(RACE) <span class="sc">%&gt;%</span> </span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>        <span class="fu">f_str</span>(<span class="st">&quot;xx (xx.x%)&quot;</span>, n, pct)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>      )</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="fu">group_desc</span>(AGE) <span class="sc">%&gt;%</span> </span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>        <span class="st">&quot;Mean (SD)&quot;</span> <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&quot;xx.x (xx.xx)&quot;</span>, mean, sd)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>      )</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="co">#&gt;   row_label1                       var1_Placebo   `var1_Xanomeline High Dose`</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                            &lt;chr&gt;          &lt;chr&gt;                      </span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="co">#&gt; 1 AMERICAN INDIAN OR ALASKA NATIVE &quot; 0 ( 0.0%)&quot;   &quot; 1 ( 1.2%)&quot;               </span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co">#&gt; 2 BLACK OR AFRICAN AMERICAN        &quot; 8 ( 9.3%)&quot;   &quot; 9 (10.7%)&quot;               </span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="co">#&gt; 3 WHITE                            &quot;78 (90.7%)&quot;   &quot;74 (88.1%)&quot;               </span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="co">#&gt; 4 Mean (SD)                        &quot;76.3 ( 8.59)&quot; &quot;75.9 ( 7.89)&quot;</span></span></code></pre></div>
<p>For each layer type, when you want to configure string formatting you
use the function <code>set_format_strings()</code>. Inside
<code>set_format_strings()</code> you provide <code>f_str()</code>
objects. Within count layers, for basic tables you can just provide a
singe <code>f_str()</code> object to control general formatting. In
descriptive statistic layers, you provide named parameters, and the
names will become the values of <code>row_label1</code> for the
statistics provided within your <code>f_str()</code> object. Regardless
of the layer type, the <code>f_str()</code> object is what controls the
numbers reported in your resulting table.</p>
<p>The table below outlines the variables available within each
layer.</p>
<table>
<colgroup>
<col width="20%" />
<col width="9%" />
<col width="70%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Layer Type</strong></th>
<th><strong>Variables</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Count Layers</strong></td>
<td>n</td>
<td>Non-distinct counts</td>
</tr>
<tr class="even">
<td></td>
<td>pct</td>
<td>Ratio of non-distinct counts to non-distinct total</td>
</tr>
<tr class="odd">
<td></td>
<td>total</td>
<td>Non-distinct total</td>
</tr>
<tr class="even">
<td></td>
<td>distinct_n</td>
<td>Distinct counts (must use <code>set_distinct_by()</code>)</td>
</tr>
<tr class="odd">
<td></td>
<td>distinct_pct</td>
<td>Ratio of distinct counts to distinct total. If population data are
set, distinct_total pulled from population data.</td>
</tr>
<tr class="even">
<td></td>
<td>distinct_total</td>
<td>Distinct total (must use <code>set_distinct_by()</code>). If
population data are set, distinct_total pulled from population
data.</td>
</tr>
<tr class="odd">
<td><strong>Shift layers</strong></td>
<td>n</td>
<td>Ratio of non-distinct counts to non-distinct total</td>
</tr>
<tr class="even">
<td></td>
<td>pct</td>
<td>Ratio of non-distinct counts to non-distinct total</td>
</tr>
<tr class="odd">
<td></td>
<td>total</td>
<td>Non-distinct total</td>
</tr>
<tr class="even">
<td><strong>Descriptive Statistics Layers</strong></td>
<td>n</td>
<td>N</td>
</tr>
<tr class="odd">
<td></td>
<td>mean</td>
<td>Mean</td>
</tr>
<tr class="even">
<td></td>
<td>sd</td>
<td>Standard Deviation</td>
</tr>
<tr class="odd">
<td></td>
<td>median</td>
<td>Median</td>
</tr>
<tr class="even">
<td></td>
<td>var</td>
<td>Variance</td>
</tr>
<tr class="odd">
<td></td>
<td>min</td>
<td>Minimum</td>
</tr>
<tr class="even">
<td></td>
<td>max</td>
<td>Maximum</td>
</tr>
<tr class="odd">
<td></td>
<td>iqr</td>
<td>Interquartile Range</td>
</tr>
<tr class="even">
<td></td>
<td>q1</td>
<td>Q1</td>
</tr>
<tr class="odd">
<td></td>
<td>q3</td>
<td>Q3</td>
</tr>
<tr class="even">
<td></td>
<td>missing</td>
<td>Missing (specifically NA counts)</td>
</tr>
</tbody>
</table>
<p><em>Note: For the actual equations used in descriptive statistics
layers, see <code>vignettes(&quot;desc&quot;)</code></em></p>
</div>
<div id="general-formatting" class="section level2">
<h2>General Formatting</h2>
<p>Looking back at the <strong>Tplyr</strong> table above, let’s look at
the count layer’s <code>f_str()</code> call.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">f_str</span>(<span class="st">&quot;xx (xx.x%)&quot;</span>, n, pct)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#&gt; *** Format String ***</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; xx (xx.x%)</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; *** vars, extracted formats, and settings ***</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; n formated as: xx</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt;  integer length: 2</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt;  decimal length: 0</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; pct formated as: xx.x</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt;  integer length: 2</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt;  decimal length: 1</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt; Total Format Size: 10</span></span></code></pre></div>
<p>You can see from the print method of the <code>f_str()</code> object
that we capture the “format string”, here <code>xx (xx.x%)</code>, and
metadata surrounding it. This string details exactly where numbers
should be placed within the output result and what that result should
look like. This is done by breaking the string down into “format
groups”, which are the separate numeric fields and their surrounding
characters within the format string.</p>
<p>This format string, <code>xx (xx.x%)</code>, has two different format
groups. The first field is <code>xx</code>, which attaches to the
variable <code>n</code>. The second is <code>(xx.x%)</code>, which
attaches to the variable <code>pct</code>. When the result is formatted,
the first format group, <code>xx</code>, will be output with a total
width of 2 characters, and space for 2 integers. The second format group
will be output with a total width of 7 characters, with space for 2
integers and 1 decimal place. For the final result, these two fields are
concatenated together, and the total width of the string will
consistently be 10 characters. Note though that formatting will not
truncate integers, and instead the total width of the string will be
expanded, skewing alignment. Decimal points are always rounded off to
the specified precision.</p>
</div>
<div id="controlling-formatting" class="section level2">
<h2>Controlling Formatting</h2>
<p>Note in the format string, the result numbers to be formatted fill
the spaces of the x’s. Other characters in the string are preserved as
is. <strong>Tplyr’s</strong> format strings have a few different valid
characters to specifically control the numeric fields.</p>
<table>
<thead>
<tr class="header">
<th align="center"><strong>Character</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>x</strong></td>
<td>One character, preserve width</td>
</tr>
<tr class="even">
<td align="center"><strong>X</strong></td>
<td>One character, hug character to the left</td>
</tr>
<tr class="odd">
<td align="center"><strong>a</strong></td>
<td>Auto precision, preserve width</td>
</tr>
<tr class="even">
<td align="center"><strong>A</strong></td>
<td>Auto precision, hug character to the left</td>
</tr>
<tr class="odd">
<td align="center"><strong>a+n</strong></td>
<td>Auto precision + n, preserve width</td>
</tr>
<tr class="even">
<td align="center"><strong>A+n</strong></td>
<td>Auto precision + n, preserve character to the left</td>
</tr>
</tbody>
</table>
<div id="lowercase-x" class="section level3">
<h3>Lowercase ‘x’</h3>
<p>As detailed in the first example, when using a lower case ‘x’, the
exact width of space allotted by the x’s will be preserved. Note the
<code>var1_Placebo</code> row below.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">tplyr_table</span>(tplyr_adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="fu">group_count</span>(RACE) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>        <span class="fu">f_str</span>(<span class="st">&quot;xx (xx.x%)&quot;</span>, n, pct)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>      )</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt;   row_label1                       var1_Placebo `var1_Xanomeline High Dose`</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                            &lt;chr&gt;        &lt;chr&gt;                      </span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; 1 AMERICAN INDIAN OR ALASKA NATIVE &quot; 0 ( 0.0%)&quot; &quot; 1 ( 1.2%)&quot;               </span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt; 2 BLACK OR AFRICAN AMERICAN        &quot; 8 ( 9.3%)&quot; &quot; 9 (10.7%)&quot;               </span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; 3 WHITE                            &quot;78 (90.7%)&quot; &quot;74 (88.1%)&quot;</span></span></code></pre></div>
<p>Both the integer width for the <code>n</code> counts and the space to
the right of the opening parenthesis of the <code>pct</code> field are
preserved. This guarentees that (when using a monospace font) the
non-numeric characters within the format strings will remain in the same
place. Given that integers don’t truncate, if these spaces are
undesired, integers will automatically increase width. In the example
below, if the <code>n</code> or <code>pct</code> result exceeds 10, the
width of the output string automatically expands. You can trigger this
behaivor by using a single ‘x’ in the integer side of a format
group.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">tplyr_table</span>(tplyr_adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="fu">group_count</span>(RACE) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>        <span class="fu">f_str</span>(<span class="st">&quot;x (x.x%)&quot;</span>, n, pct)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>      )</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt;   row_label1                       var1_Placebo `var1_Xanomeline High Dose`</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                            &lt;chr&gt;        &lt;chr&gt;                      </span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; 1 AMERICAN INDIAN OR ALASKA NATIVE 0 (0.0%)     1 (1.2%)                   </span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt; 2 BLACK OR AFRICAN AMERICAN        8 (9.3%)     9 (10.7%)                  </span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; 3 WHITE                            78 (90.7%)   74 (88.1%)</span></span></code></pre></div>
</div>
<div id="uppercase-x" class="section level3">
<h3>Uppercase ‘X’</h3>
<p>The downside of the last example is that alignment between format
groups is completely lost. The parenthesis in the <code>pct</code> field
is now bound to the integer of the percent value, but the entire string
is shifted to the right. <strong>Tplyr</strong> offers customization
over this by using a concept called “parenthesis hugging”. This is
triggered by using an uppercase ‘X’ in the integer side of a format
group. Consider the following example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">tplyr_table</span>(tplyr_adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    <span class="fu">group_count</span>(RACE) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>        <span class="fu">f_str</span>(<span class="st">&quot;xx (XX.x%)&quot;</span>, n, pct)</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>      )</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt;   row_label1                       var1_Placebo `var1_Xanomeline High Dose`</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                            &lt;chr&gt;        &lt;chr&gt;                      </span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; 1 AMERICAN INDIAN OR ALASKA NATIVE &quot; 0  (0.0%)&quot; &quot; 1  (1.2%)&quot;               </span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; 2 BLACK OR AFRICAN AMERICAN        &quot; 8  (9.3%)&quot; &quot; 9 (10.7%)&quot;               </span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; 3 WHITE                            &quot;78 (90.7%)&quot; &quot;74 (88.1%)&quot;</span></span></code></pre></div>
<p>Now the total string width has been preserved properly. The change
here is that instead of pulling the right side of the format group in,
essentially aligning left on the format group, the parenthesis has been
moved to the right towards the integer side of the <code>pct</code>
field, “hugging” the numeric results of the percent.</p>
<p>There are a two rules when using ‘parenthesis hugging’:</p>
<ul>
<li>Capital letters should only be used on the integer side of a
number</li>
<li>A character must precede the capital letter, otherwise there’s no
character to ‘hug’</li>
</ul>
</div>
</div>
<div id="auto-precision" class="section level2">
<h2>Auto-precision</h2>
<p>Lastly, <strong>Tplyr</strong> also has the capability to
automatically determine some widths necessary to format strings. This is
done by using the character ‘a’ instead of ‘x’ in the format string.</p>
<p>Consider the following example.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">tplyr_table</span>(tplyr_adlb, TRTA, <span class="at">where=</span>PARAMCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;CA&quot;</span>, <span class="st">&quot;URATE&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="fu">group_desc</span>(AVAL, <span class="at">by=</span><span class="fu">vars</span>(PARAMCD, AVISIT)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>        <span class="st">&#39;Mean (SD)&#39;</span> <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&#39;a.a (a.a+1)&#39;</span>, mean, sd)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>      <span class="fu">set_precision_by</span>(PARAMCD)</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 5</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt;   row_label1 row_label2 row_label3 var1_Placebo       var1_Xanomeline High Dos…¹</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;              &lt;chr&gt;                     </span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; 1 CA         Week 12    Mean (SD)  2.18312 (0.074711) 2.17897 (0.062553)        </span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; 2 CA         Week 24    Mean (SD)  2.16233 (0.046617) 2.19560 (0.099174)        </span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; 3 CA         Week 8     Mean (SD)  2.17065 (0.102771) 2.19560 (0.199489)        </span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; 4 URATE      Week 12    Mean (SD)  249.816 (105.3868) 264.686 ( 85.1772)        </span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; 5 URATE      Week 24    Mean (SD)  226.024 (111.8899) 273.608 (126.6612)        </span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; 6 URATE      Week 8     Mean (SD)  237.920 ( 45.8806) 291.452 ( 36.6659)        </span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; # ℹ abbreviated name: ¹​`var1_Xanomeline High Dose`</span></span></code></pre></div>
<p>Note that the decimal precision varies between different lab test
results. This feature is beneficial when decimal precision rules must be
based on the precision of the data as collected. For more information of
auto-precision for descriptive statistics layers, see
<code>vignette(&quot;desc_layer_formatting&quot;)</code>.</p>
<p>For count layers, auto-precision can also be used surrounding the
<code>n</code> counts. For example, the default format string for counts
layers in <strong>Tplyr</strong> is set as <code>a (xxx.x%)</code>. This
will auto-format the <code>n</code> result based on the maximum
summarized value of <code>n</code> within the data. For example:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">tplyr_table</span>(tplyr_adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="fu">group_count</span>(RACE) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(<span class="fu">f_str</span>(<span class="st">&quot;a (xxx.x%)&quot;</span>, n, pct))</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt;   row_label1                       var1_Placebo  `var1_Xanomeline High Dose`</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                            &lt;chr&gt;         &lt;chr&gt;                      </span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; 1 AMERICAN INDIAN OR ALASKA NATIVE &quot; 0 (  0.0%)&quot; &quot; 1 (  1.2%)&quot;              </span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; 2 BLACK OR AFRICAN AMERICAN        &quot; 8 (  9.3%)&quot; &quot; 9 ( 10.7%)&quot;              </span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; 3 WHITE                            &quot;78 ( 90.7%)&quot; &quot;74 ( 88.1%)&quot;</span></span></code></pre></div>
<p>Given that the maximum count was &gt;=10 and &lt;100, the integer
width for <code>n</code> was assigned as 2. Note that auto-precision for
percents will not auto-format based on available percentages. The count
filled by <code>a</code> will be based on the <code>n</code> result.</p>
<p>For both layer types, a capital <code>A</code> follows the same logic
as <code>X</code>, but is triggered using auto-precision. Take this
example of an adverse event table:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">tplyr_table</span>(tplyr_adae, TRTA) <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="fu">set_pop_data</span>(tplyr_adsl) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="fu">set_pop_treat_var</span>(TRT01A) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    <span class="fu">group_count</span>(AEDECOD) <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(<span class="fu">f_str</span>(<span class="st">&quot;a (XX.x%) [A]&quot;</span>, distinct_n, distinct_pct, n)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>      <span class="fu">set_distinct_by</span>(USUBJID)</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; # A tibble: 21 × 3</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt;    row_label1         var1_Placebo      `var1_Xanomeline High Dose`</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;              &lt;chr&gt;             &lt;chr&gt;                      </span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt;  1 ACTINIC KERATOSIS  &quot; 0  (0.0%)  [0]&quot; &quot; 1  (1.2%)  [1]&quot;          </span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt;  2 ALOPECIA           &quot; 1  (1.2%)  [1]&quot; &quot; 0  (0.0%)  [0]&quot;          </span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt;  3 BLISTER            &quot; 0  (0.0%)  [0]&quot; &quot; 1  (1.2%)  [2]&quot;          </span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt;  4 COLD SWEAT         &quot; 1  (1.2%)  [3]&quot; &quot; 0  (0.0%)  [0]&quot;          </span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt;  5 DERMATITIS ATOPIC  &quot; 1  (1.2%)  [1]&quot; &quot; 0  (0.0%)  [0]&quot;          </span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt;  6 DERMATITIS CONTACT &quot; 0  (0.0%)  [0]&quot; &quot; 0  (0.0%)  [0]&quot;          </span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="co">#&gt;  7 DRUG ERUPTION      &quot; 1  (1.2%)  [1]&quot; &quot; 0  (0.0%)  [0]&quot;          </span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="co">#&gt;  8 ERYTHEMA           &quot; 9 (10.5%) [13]&quot; &quot;14 (16.7%) [22]&quot;          </span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="co">#&gt;  9 HYPERHIDROSIS      &quot; 2  (2.3%)  [2]&quot; &quot; 8  (9.5%) [10]&quot;          </span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="co">#&gt; 10 PRURITUS           &quot; 8  (9.3%) [11]&quot; &quot;26 (31.0%) [38]&quot;          </span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="co">#&gt; # ℹ 11 more rows</span></span></code></pre></div>
<p>To go over each format group:</p>
<ul>
<li>The distinct n count has been spaced based on the width of the
maximum <code>n</code> value</li>
<li>The percent field will have a maximum width of 2 characters, but the
opening parenthesis will hug the integer of the percent value to the
right</li>
<li>The event counts within brackets (<code>[]</code>) have been auto
formatted based on the maximum <code>n</code> value, and the opening
bracket will hug the <code>n</code> count to the right.</li>
</ul>
<p>This vignette has focused on the specifics of formatting using
<code>f_str()</code> objects. For more details on layer specifics, check
out the individual layer vignettes.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
