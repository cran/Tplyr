<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Descriptive Statistic Layers</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Descriptive Statistic Layers</h1>


<div id="TOC">
<ul>
<li><a href="#built-in-summaries" id="toc-built-in-summaries">Built-in
Summaries</a>
<ul>
<li><a href="#notes-about-built-ins" id="toc-notes-about-built-ins">Notes About Built-in’s</a></li>
</ul></li>
<li><a href="#custom-summaries" id="toc-custom-summaries">Custom
Summaries</a></li>
</ul>
</div>

<p>Descriptive statistics in <strong>Tplyr</strong> are created using
<code>group_desc()</code> function when creating a layer. While
<code>group_desc()</code> allows you to set your target, by variables,
and filter criteria, a great deal of the control of the layer comes from
<code>set_format_strings()</code> where the actual summaries are
declared.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tplyr_table</span>(adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_desc</span>(AGE, <span class="at">by =</span> <span class="st">&quot;Age (years)&quot;</span>, <span class="at">where=</span> SAFFL<span class="sc">==</span><span class="st">&quot;Y&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;n&quot;</span>        <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&quot;xx&quot;</span>, n),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Mean (SD)&quot;</span><span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&quot;xx.x (xx.xx)&quot;</span>, mean, sd),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Median&quot;</span>   <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&quot;xx.x&quot;</span>, median),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Q1, Q3&quot;</span>   <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&quot;xx, xx&quot;</span>, q1, q3),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Min, Max&quot;</span> <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&quot;xx, xx&quot;</span>, min, max),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Missing&quot;</span>  <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&quot;xx&quot;</span>, missing)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="9%" />
<col width="8%" />
<col width="10%" />
<col width="20%" />
<col width="19%" />
<col width="12%" />
<col width="9%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">n</td>
<td align="left">86</td>
<td align="left">84</td>
<td align="left">84</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Age (years)</td>
<td align="left">Mean (SD)</td>
<td align="left">75.2 ( 8.59)</td>
<td align="left">74.4 ( 7.89)</td>
<td align="left">75.7 ( 8.29)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">Median</td>
<td align="left">76.0</td>
<td align="left">76.0</td>
<td align="left">77.5</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Age (years)</td>
<td align="left">Q1, Q3</td>
<td align="left">69, 82</td>
<td align="left">71, 80</td>
<td align="left">71, 82</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">Min, Max</td>
<td align="left">52, 89</td>
<td align="left">56, 88</td>
<td align="left">51, 88</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">Age (years)</td>
<td align="left">Missing</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
<p>Let’s walk through this call to <code>set_format_strings</code> to
understand in detail what’s going on:</p>
<ol style="list-style-type: decimal">
<li>The quoted strings on the left of the ‘=’ within
<code>set_format_strings()</code> become the row label in the output.
This allows you to define some custom text in
<code>set_format_strings()</code> to explain the summary that is
presented on the associated row. This text is fully in your
control.</li>
<li>On the right side of each equals is a call to <code>f_str()</code>.
As explained in the <code>vignette(&quot;Tplyr&quot;)</code>, this is an object
that captures a lot of metadata to understand how the strings should be
presented.</li>
<li>Within the <code>f_str()</code> call, you see x’s in quotes. This
defines how you’d like the numbers formatted from the resulting
summaries. The number of x’s you use on the left side of a decimal
control the space allotted for an integer, and the right side controls
the decimal precision. Decimals are rounded prior to string formatting -
so no need to worry about that. Note that this forcefully sets the
decimal and integer precision - <strong>Tplyr</strong> can automatically
determine this for you as well, but more on that later.</li>
<li>After the x’s there are unquoted variable names. This is where you
specify the actual summaries that will be performed. Notice that some
<code>f_str()</code> calls have two summaries specified. This allows you
to put two summaries in the same string and present them on the same
line.</li>
</ol>
<p>But where do these summary names come from? And which ones does
<strong>Tplyr</strong> have?</p>
<div id="built-in-summaries" class="section level2">
<h2>Built-in Summaries</h2>
<p>We’ve built a number of default summaries into
<strong>Tplyr</strong>, which allows you to perform these summaries
without having to specify the functions to calculate them yourself. The
summaries built in to <strong>Tplyr</strong> are listed below. In the
second column are the names that you would use within an
<code>f_str()</code> call to use them. In the third column, we have the
syntax used to make the function call.</p>
<table>
<colgroup>
<col width="19%" />
<col width="14%" />
<col width="65%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Statistic</th>
<th align="center">Variable Names</th>
<th align="left">Function Call</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">N</td>
<td align="center">n</td>
<td align="left">n()</td>
</tr>
<tr class="even">
<td align="center">Mean</td>
<td align="center">mean</td>
<td align="left">mean(.var, na.rm=TRUE)</td>
</tr>
<tr class="odd">
<td align="center">Standard Deviation</td>
<td align="center">sd</td>
<td align="left">sd(.var, na.rm=TRUE)</td>
</tr>
<tr class="even">
<td align="center">Median</td>
<td align="center">median</td>
<td align="left">median(.var, na.rm=TRUE)</td>
</tr>
<tr class="odd">
<td align="center">Variance</td>
<td align="center">var</td>
<td align="left">var(.var, na.rm=TRUE)</td>
</tr>
<tr class="even">
<td align="center">Minimum</td>
<td align="center">min</td>
<td align="left">min(.var, na.rm=TRUE)</td>
</tr>
<tr class="odd">
<td align="center">Maximum</td>
<td align="center">max</td>
<td align="left">max(.var, na.rm=TRUE)</td>
</tr>
<tr class="even">
<td align="center">Interquartile Range</td>
<td align="center">iqr</td>
<td align="left">IQR(.var, na.rm=TRUE,
type=getOption(‘tplyr.quantile_type’)</td>
</tr>
<tr class="odd">
<td align="center">Q1</td>
<td align="center">q1</td>
<td align="left">quantile(.var, na.rm=TRUE,
type=getOption(‘tplyr.quantile_type’))[[2]]</td>
</tr>
<tr class="even">
<td align="center">Q3</td>
<td align="center">q3</td>
<td align="left">quantile(.var, na.rm=TRUE,
type=getOption(‘tplyr.quantile_type’))[[4]]</td>
</tr>
<tr class="odd">
<td align="center">Missing</td>
<td align="center">missing</td>
<td align="left">sum(is.na(.var))</td>
</tr>
</tbody>
</table>
<div id="notes-about-built-ins" class="section level3">
<h3>Notes About Built-in’s</h3>
<p>Note that the only non-default option being used in any of the
function calls above is <code>na.rm=TRUE</code>. For most of the
functions, this is likely fine - but with IQR, Q1, and Q3 note that
there are several different quantile algorithms available in R. The
default we chose to use is the R default of Type 7:</p>
<p><span class="math display">\[
m = 1-p. p[k] = (k - 1) / (n - 1). \textrm{In this case, } p[k] =
mode[F(x[k])]. \textrm{This is used by S.}
\]</span> That said, we still want to offer some flexibility here, so
you can change the quantile algorithm by switching the
<code>tplyr.quantile_type</code> option. If you’re intending to match
the SAS definition, you can use Type 3. For more information, see the
<code>stats::quantile()</code> documentation.</p>
<p>The example below demonstrates using the default quantile algorithm
in R.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tplyr_table</span>(adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_desc</span>(CUMDOSE) <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(<span class="st">&quot;Q1, Q3&quot;</span> <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&#39;xxxxx, xxxxx&#39;</span>, q1, q3))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">&quot;ord&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="14%" />
<col width="17%" />
<col width="34%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Q1, Q3</td>
<td align="left">0, 0</td>
<td align="left">2646, 13959</td>
<td align="left">1984, 9801</td>
</tr>
</tbody>
</table>
<p>This next example demonstrates using quantile algorithm Type 3, which
matches the SAS definition of:</p>
<p><span class="math display">\[
\textrm{Nearest even order statistic. γ = 0 if g = 0 and  j is even, and
1 otherwise.}
\]</span></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tplyr.quantile_type =</span> <span class="dv">3</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tplyr_table</span>(adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_desc</span>(CUMDOSE) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(<span class="st">&quot;Q1, Q3&quot;</span> <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&#39;xxxxx, xxxxx&#39;</span>, q1, q3))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">&quot;ord&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="14%" />
<col width="17%" />
<col width="34%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Q1, Q3</td>
<td align="left">0, 0</td>
<td align="left">2565, 13959</td>
<td align="left">1944, 9774</td>
</tr>
</tbody>
</table>
<p>It’s up to you to determine which algorithm you should use - but we
found it necessary to provide you with the flexibility to change this
within the default summaries.</p>
<p>But what if <strong>Tplyr</strong> doesn’t offer you the summaries
that you need?</p>
</div>
</div>
<div id="custom-summaries" class="section level2">
<h2>Custom Summaries</h2>
<p>We understand that our defaults may not cover every descriptive
statistic that you’d like to see. That’s why we’ve opened to door to
creating custom summaries. Custom summaries allow you to provide any
function you’d like into a desc layer. You can focus on the derivation
and how to calculate the number you want to see. <strong>Tplyr</strong>
can consume this function, and use all the existing tools within
<strong>Tplyr</strong> to produce the string formatted result alongside
any of the default summaries we provide as well.</p>
<p>Custom summaries may be provided in two ways:</p>
<ul>
<li>Through the <code>tplyr.custom_summaries</code> option set at your
session level</li>
<li>Through the function <code>set_custom_summaries()</code> at the
layer level</li>
</ul>
<p>As with any other setting in <strong>Tplyr</strong>, the layer
setting will always take precedence over any other setting.</p>
<p>Let’s look at an example.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tplyr_table</span>(adsl, TRT01P) <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_desc</span>(<span class="fu">vars</span>(AGE, HEIGHTBL), <span class="at">by =</span> <span class="st">&quot;Sepal Length&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_custom_summaries</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">geometric_mean =</span> <span class="fu">exp</span>(<span class="fu">sum</span>(<span class="fu">log</span>(.var[.var <span class="sc">&gt;</span> <span class="dv">0</span>]), <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">length</span>(.var))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;Geometric Mean (SD)&#39;</span> <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&#39;xx.xx (xx.xxx)&#39;</span>, geometric_mean, sd)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">&quot;ord&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="7%" />
<col width="12%" />
<col width="9%" />
<col width="15%" />
<col width="15%" />
<col width="9%" />
<col width="15%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="left">var2_Placebo</th>
<th align="left">var2_Xanomeline High Dose</th>
<th align="left">var2_Xanomeline Low Dose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Sepal Length</td>
<td align="left">Geometric Mean (SD)</td>
<td align="left">74.70 ( 8.590)</td>
<td align="left">73.94 ( 7.886)</td>
<td align="left">75.18 ( 8.286)</td>
<td align="left">162.17 (11.522)</td>
<td align="left">165.51 (10.131)</td>
<td align="left">163.11 (10.419)</td>
</tr>
</tbody>
</table>
<p>Here, a few important things are demonstrated:</p>
<ul>
<li>This is a multi-variable descriptive statistics layer. Both
<code>AGE</code> and <code>HEIGHTBL</code> are being summarized in the
same layer. <code>AGE</code> results go to the <code>var1_</code>
variables and <code>HEIGHTBL</code> results go to the <code>var2_</code>
variables.</li>
<li>The parameter names in <code>set_custom_summaries()</code>, or names
on the left side of the equals, flow into
<code>set_format_strings()</code> in the <code>f_str()</code> calls.
Just like the default summaries, <code>geometric_mean</code> becomes the
name that you refer to in order to use the geometric mean derivation in
a summary.</li>
<li>In geometric mean, the target variable that you’re summarizing is
referred to as <code>.var</code>. This may not seem intuitive. The
reason we have to use <code>.var</code> is so that, like in this
example, the custom function can be applied to each of the separate
target variables.</li>
</ul>
<p>Another note about custom summaries is that you’re able to overwrite
the default summaries built into <strong>Tplyr</strong> as well. Don’t
like the default summary functions that we provide? Use the
<code>tplyr.custom_summaries</code> option to overwrite them in your
session, and add any new ones that you would like to include.</p>
<p>For example, here we use the <strong>Tplyr</strong> default mean.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tplyr_table</span>(adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_desc</span>(AGE) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(<span class="st">&quot;Mean&quot;</span> <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&#39;xx.xx&#39;</span>, mean))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="10%" />
<col width="12%" />
<col width="25%" />
<col width="24%" />
<col width="15%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Mean</td>
<td align="left">75.21</td>
<td align="left">74.38</td>
<td align="left">75.67</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>But now, let’s overwrite <code>mean</code> using a custom summary.
Let’s use a trimmed mean instead, taking 20% of observations off of both
ends.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tplyr.custom_summaries =</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>          rlang<span class="sc">::</span><span class="fu">quos</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean =</span> <span class="fu">mean</span>(.var, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">trim=</span><span class="fl">0.4</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tplyr_table</span>(adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_desc</span>(AGE) <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(<span class="st">&quot;Mean&quot;</span> <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&#39;xx.xx&#39;</span>, mean))</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="10%" />
<col width="12%" />
<col width="25%" />
<col width="24%" />
<col width="15%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Mean</td>
<td align="left">76.28</td>
<td align="left">75.94</td>
<td align="left">77.44</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Note that the table code used to produce the output is the same. Now
<strong>Tplyr</strong> used the custom summary function for
<code>mean</code> as specified in the
<code>tplyr.custom_summaries</code> option. Also note the use of
<code>rlang::quos()</code>. We’ve done our best to mask this from the
user everywhere possible and make the interfaces clean and intuitive,
but a great deal of <strong>Tplyr</strong> is built using ‘rlang’ and
non-standard evaluation. Within this option is one of the very few
instances where a user needs to concern themselves with the use of
quosures. If you’d like to learn more about non-standard evaluation and
quosures, we recommend <a href="https://adv-r.hadley.nz/metaprogramming.html">Section IV</a> in
Advanced R.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
