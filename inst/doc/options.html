<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Tplyr Options</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Tplyr Options</h1>


<div id="TOC">
<ul>
<li><a href="#default-layer-formats">Default Layer Formats</a></li>
<li><a href="#precision-cap">Precision Cap</a></li>
<li><a href="#custom-summaries">Custom Summaries</a></li>
<li><a href="#scientific-notation">Scientific Notation</a></li>
<li><a href="#quantile-algorithms">Quantile Algorithms</a></li>
</ul>
</div>

<p>One thing that we wanted to build into ‘Tplyr’ to make it a user friendly package is the ability to eliminate redundant code where possible. This is why there are several options available in ‘Tplyr’ to allow you to control things at your session level instead of each individual table, or even each individual layer.</p>
<p>The following are the options available in ‘Tplyr’ and their descriptions:</p>
<table>
<colgroup>
<col width="10%" />
<col width="89%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Option</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">tplyr.count_layer_default_formats</td>
<td align="left">The default format strings for a count layer. Defaults to an auto-calculated n width, and (xxx.x%) for distinct counts (if available - non-distinct counts are used otherwise). Risk difference formats default to dif (low CI, high CI), all with 2 integer spaces and 3 decimal places.</td>
</tr>
<tr class="even">
<td align="center">tplyr.shift_layer_default_formats</td>
<td align="left">The default shift layer format. Defaults to an auto-calculated n width.</td>
</tr>
<tr class="odd">
<td align="center">tplyr.desc_layer_default_formats</td>
<td align="left">The default descriptive statistics layer format. Defaults to “n”, “Mean (SD)”, “Median”, “Q1, Q3”, “Min, Max”, and “Missing”. Everything except “n” and “Missing” use auto-precision. Mean, Q1, Q3, and median defaults to +1 decimal places and Standard Deviation defaults to +2.</td>
</tr>
<tr class="even">
<td align="center">tplyr.precision_cap</td>
<td align="left">The default precision cap for auto-precision. Both integer and decimal places default to 99, essentially ensuring that precision is not capped by default.</td>
</tr>
<tr class="odd">
<td align="center">tplyr.custom_summaries</td>
<td align="left">Default custom summaries available to Tplyr. Defaults to NULL, as Tplyr’s defaults are seen as built-ins and not custom summaries.</td>
</tr>
<tr class="even">
<td align="center">tplyr.scipen</td>
<td align="left">The default ‘scipen’ setting used while Tplyr is executing. Defaults to 1000. See the R documentation on the ‘scipen’ option to understand more, but this allows you to control how small a number must be before scientific notation is used when a number is string formatted in presentation.</td>
</tr>
<tr class="odd">
<td align="center">tplyr.quantile_type</td>
<td align="left">The default quantile algorithm used by Tpylr when using the built-in summaries for Q1, Q3, and IQR. Defaults to Type 7, which is the R default</td>
</tr>
</tbody>
</table>
<p>Each of these options allows you to set these settings in one place, and every ‘Tplyr’ table you create will inherit your option settings as defaults. This allows your table code to be more concise, and centralizes where you need to make an update when your code has to be adjusted. This vignette is dedicated to helping you understand how to leverage each of these options properly.</p>
<div id="default-layer-formats" class="section level2">
<h2>Default Layer Formats</h2>
<p>Declaring string formats and summaries that need to be performed is one of the more verbose parts of ‘Tplyr’. Furthermore, this is something that will often be fairly consistent within a study, as you’ll likely want to look across a consistent set of descriptive statistics, or your count/shift tables will likely require the same sort of “n (%)” formatting.</p>
<p>Using the format options is very similar to setting a string format. The only difference is that you need to enter the string formats as a named list instead of as separate parameters to a function call.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Count layer defaults</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">tplyr.count_layer_default_formats =</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">n_counts =</span> <span class="fu">f_str</span>(<span class="st">&quot;xxx (xx%)&quot;</span>, n, pct),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">riskdiff =</span> <span class="fu">f_str</span>(<span class="st">&#39;xx.xxx&#39;</span>, dif)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>         ),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Desc layer defaults</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">tplyr.desc_layer_default_formats =</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="st">&quot;n&quot;</span>        <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&quot;xxx&quot;</span>, n),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Mean (SD)&quot;</span><span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&quot;a.a+1 (a.a+2)&quot;</span>, mean, sd),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Median&quot;</span>   <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&quot;a.a+4&quot;</span>, median)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>         ),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Shift layer defaults</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">tplyr.shift_layer_default_formats =</span> <span class="fu">list</span>(<span class="fu">f_str</span>(<span class="st">&quot;xxx&quot;</span>, n))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a> </span></code></pre></div>
<p>Here you can see that ‘Tplyr’ picks up these option changes. In the table below, we didn’t use <code>set_format_strings()</code> anywhere - instead we let ‘Tplyr’ pick up the default formats from the options.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tplyr_table</span>(adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_desc</span>(AGE, <span class="at">by =</span> <span class="st">&quot;Age (years)&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_count</span>(AGEGR1, <span class="at">by =</span> <span class="st">&quot;Categorical Age Groups&quot;</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="16%" />
<col width="7%" />
<col width="9%" />
<col width="18%" />
<col width="18%" />
<col width="11%" />
<col width="8%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">n</td>
<td align="left">86</td>
<td align="left">84</td>
<td align="left">84</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Age (years)</td>
<td align="left">Mean (SD)</td>
<td align="left">76.3 ( 8.59)</td>
<td align="left">75.9 ( 7.89)</td>
<td align="left">77.4 ( 8.29)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">Median</td>
<td align="left">76.0</td>
<td align="left">76.0</td>
<td align="left">77.5</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Age (years)</td>
<td align="left">Q1, Q3</td>
<td align="left">69.2, 81.8</td>
<td align="left">70.8, 80.0</td>
<td align="left">71.0, 82.0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">Min, Max</td>
<td align="left">52, 89</td>
<td align="left">56, 88</td>
<td align="left">51, 88</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">Age (years)</td>
<td align="left">Missing</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Categorical Age Groups</td>
<td align="left">65-80</td>
<td align="left">42 ( 48.8%)</td>
<td align="left">55 ( 65.5%)</td>
<td align="left">47 ( 56.0%)</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Categorical Age Groups</td>
<td align="left">&lt;65</td>
<td align="left">14 ( 16.3%)</td>
<td align="left">11 ( 13.1%)</td>
<td align="left">8 ( 9.5%)</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Categorical Age Groups</td>
<td align="left">&gt;80</td>
<td align="left">30 ( 34.9%)</td>
<td align="left">18 ( 21.4%)</td>
<td align="left">29 ( 34.5%)</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<p>One important thing to understand about how these options work in particular is the scoping.</p>
<ul>
<li>‘Tplyr’ options have the broadest scope, as they work across the entire session for any table.</li>
<li>Setting formats at the <code>tplyr_table()</code> level will override the ‘Tplyr’ options and extends to any layer of the specified type in the current table.</li>
<li>Setting formats at the <code>tplyr_layer()</code> level will always be prioritized over ‘Tplyr’ options and any <code>tplyr_table()</code> formats set. This has the narrowest scope and will always be used when specified.</li>
</ul>
<p>To demonstrate, consider the following. The ‘Tplyr’ options remain set from the block above.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tplyr_table</span>(adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_count_layer_formats</span>(<span class="at">n_counts =</span> <span class="fu">f_str</span>(<span class="st">&quot;xx (xxx%)&quot;</span>, n, pct)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_desc_layer_formats</span>(<span class="st">&quot;Mean (SD)&quot;</span> <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&quot;a.a+1 (a.a+2)&quot;</span>, mean, sd)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_desc</span>(AGE, <span class="at">by =</span> <span class="st">&quot;Age (Years)&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_count</span>(AGEGR1, <span class="at">by =</span> <span class="st">&quot;Categorical Age Groups&quot;</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_count</span>(ETHNIC, <span class="at">by =</span> <span class="st">&quot;Ethnicity&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(<span class="fu">f_str</span>(<span class="st">&quot;xxxxx (xx.xxx%)&quot;</span>, n, pct))</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="15%" />
<col width="15%" />
<col width="8%" />
<col width="17%" />
<col width="16%" />
<col width="10%" />
<col width="8%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Age (Years)</td>
<td align="left">Mean (SD)</td>
<td align="left">76.3 ( 8.59)</td>
<td align="left">75.9 ( 7.89)</td>
<td align="left">77.4 ( 8.29)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Categorical Age Groups</td>
<td align="left">65-80</td>
<td align="left">42 ( 49%)</td>
<td align="left">55 ( 65%)</td>
<td align="left">47 ( 56%)</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Categorical Age Groups</td>
<td align="left">&lt;65</td>
<td align="left">14 ( 16%)</td>
<td align="left">11 ( 13%)</td>
<td align="left">8 ( 10%)</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Categorical Age Groups</td>
<td align="left">&gt;80</td>
<td align="left">30 ( 35%)</td>
<td align="left">18 ( 21%)</td>
<td align="left">29 ( 35%)</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Ethnicity</td>
<td align="left">HISPANIC OR LATINO</td>
<td align="left">3 ( 3.488%)</td>
<td align="left">3 ( 3.571%)</td>
<td align="left">6 ( 7.143%)</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Ethnicity</td>
<td align="left">NOT HISPANIC OR LATINO</td>
<td align="left">83 (96.512%)</td>
<td align="left">81 (96.429%)</td>
<td align="left">78 (92.857%)</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>In the above output:</p>
<ul>
<li>The descriptive statistics layer for “Age (Years)” uses the specified table default using <code>set_desc_layer_formats()</code></li>
<li>The first count layer for “Categorical Age Groups” uses the specified table default using <code>set_count_layer_formats()</code></li>
<li>The second count layer for “Ethnicity” uses the layer level format specified using <code>set_format_strings()</code></li>
</ul>
<p>Each of the outputs ignores the ‘Tpylr’ option defaults.</p>
</div>
<div id="precision-cap" class="section level2">
<h2>Precision Cap</h2>
<p>‘Tplyr’ defaults to avoiding capping precision. We do this because capping precision should be a conscious decision, where you as the user specifically set the limit of how many decimal places are relevant to a specific result. One way to cap precision is by using the <code>cap</code> parameter within <code>set_format_strings()</code>. But perhaps you have a specific limit to what you’d like to see on any output. Here, we offer the <code>tplyr.precision_cap</code> option to set whatever cap you wish.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tplyr.precision_cap =</span> <span class="fu">c</span>(<span class="st">&#39;int&#39;</span><span class="ot">=</span><span class="dv">2</span>, <span class="st">&#39;dec&#39;</span><span class="ot">=</span><span class="dv">2</span>))</span></code></pre></div>
<p>Similar to the layer defaults, setting a precision cap at the layer level will override the <code>tplyr.precision_cap</code> option.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tplyr_table</span>(adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_desc</span>(HEIGHTBL, <span class="at">by =</span> <span class="st">&quot;Height at Baseline&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;Mean (SD)&#39;</span> <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&#39;a.a (a.a+1)&#39;</span>, mean, sd)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_desc</span>(HEIGHTBL, <span class="at">by =</span> <span class="st">&quot;Height at Baseline (Limited)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;Mean (SD)&#39;</span> <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&#39;a.a (a.a+1)&#39;</span>, mean, sd),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">cap =</span> <span class="fu">c</span>(<span class="st">&#39;int&#39;</span><span class="ot">=</span> <span class="dv">1</span>, <span class="st">&#39;dec&#39;</span><span class="ot">=</span><span class="dv">0</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="20%" />
<col width="7%" />
<col width="9%" />
<col width="17%" />
<col width="17%" />
<col width="11%" />
<col width="8%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">row_label1</th>
<th align="left">row_label2</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
<th align="right">ord_layer_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Height at Baseline</td>
<td align="left">Mean (SD)</td>
<td align="left">162.4 (11.52)</td>
<td align="left">166.4 (10.13)</td>
<td align="left">162.1 (10.42)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Height at Baseline (Limited)</td>
<td align="left">Mean (SD)</td>
<td align="left">162 (11.5)</td>
<td align="left">166 (10.1)</td>
<td align="left">162 (10.4)</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Both layers in the above example are summarizing the same data. The top layer is using the <code>tplyr.precision_cap</code> option set above, which limits to 2 integer place and 2 decimal places. To bottom layer applies its own cap to override the option. Recall a few things about auto precision:</p>
<ul>
<li>Integers will not be truncated - rather, the auto precision will default how much padding should be applied. If the number exceeds that number of spaces, then the length will be extended (i.e. if 2 integer places are allotted, 100 will still consume 3 places).</li>
<li>The cap applies to the spaces allotted by the ‘a’. If the cap is 2, ‘a+1’ will not exceed 3 spaces.</li>
</ul>
<p>The bottom layer overrides the ‘Tplyr’ option. Instead, integers are capped at 1 space, and decimals are capped at 0.</p>
</div>
<div id="custom-summaries" class="section level2">
<h2>Custom Summaries</h2>
<p>Custom summaries allow you to extend the capabilities of descriptive statistics layers in ‘Tplyr’. Maybe our defaults don’t work how you’d like them to, or maybe you have some custom functions within your organization that you commonly would like to use. Specifying the custom summaries you wish to use in every table would prove quite tedious - therefore, the <code>tplyr.custom_summaries</code> option is a better choice.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tplyr.custom_summaries =</span> rlang<span class="sc">::</span><span class="fu">quos</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">geometric_mean =</span> <span class="fu">exp</span>(<span class="fu">sum</span>(<span class="fu">log</span>(.var[.var <span class="sc">&gt;</span> <span class="dv">0</span>]),<span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">length</span>(.var))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>))</span></code></pre></div>
<p>Note that the table code used to produce the output is the same. Now ‘Tplyr’ used the custom summary function for <code>geometric_mean</code> as specified in the <code>tplyr.custom_summaries</code> option. Also note the use of <code>rlang::quos()</code>. We’ve done our best to mask this from the user everywhere possible and make the interfaces clean and intuitive, but a great deal of ‘Tplyr’ is built using ‘rlang’ and non-standard evaluation. Within this option is one of the very few instances where a user needs to concern themselves with the use of quosures. If you’d like to learn more about non-standard evaluation and quosures, we recommend <a href="https://adv-r.hadley.nz/metaprogramming.html">Section IV</a> in Advanced R.</p>
<p>Now that geometric mean is set within the ‘Tplyr’ options, you can use it within your descriptive statistics layers, just like it was one of the built-in summaries.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tplyr_table</span>(adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_desc</span>(AGE) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(<span class="st">&#39;Geometric Mean&#39;</span> <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&#39;xx.xx&#39;</span>, geometric_mean))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="14%" />
<col width="12%" />
<col width="24%" />
<col width="23%" />
<col width="14%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Geometric Mean</td>
<td align="left">74.70</td>
<td align="left">73.94</td>
<td align="left">75.18</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<div id="scientific-notation" class="section level2">
<h2>Scientific Notation</h2>
<p>By default, R will switch to scientific notation for a number less than .001. This is controlled by the <code>scipen</code> option. The default value of <code>scipen</code> is 0. If you’d like to increase the decimal places required for scientific notation to be triggered, increase the value of <code>scipen</code>. The value of <code>scipen</code> is the number of orders of ten smaller (i.e. decimal places preceded by 0’s) required to switch to scientific notation. Decreasing the value of <code>scipen</code> will cause R to switch to scientific location for larger numbers.</p>
<p>This is easier to understand with an example.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">0</span>) <span class="co"># This is the default</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>.<span class="dv">0001</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1e-04</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">1</span>) <span class="co"># Require 5 decimal places instead</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>.<span class="dv">0001</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.0001</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>.<span class="dv">00001</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1e-05</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="co"># Only require 3 decimal places</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>.<span class="dv">001</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1e-03</span></span></code></pre></div>
<p>In ‘Tplyr’, we have the option <code>tplyr.scipen</code>. This is the <code>scipen</code> setting that will be used <em>only</em> while the ‘Tplyr’ table is being built. This allows you to use a different <code>scipen</code> setting within ‘Tplyr’ than your R session. The default value we use in ‘Tplyr’ is 9999, which is intended to totally prevent numbers from switching to scientific notation. We want this to be a conscious decision that you make in order to prevent any unexpected outputs.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tplyr.scipen =</span> <span class="sc">-</span><span class="dv">3</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">tplyr_table</span>(adae, TRTA) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_count</span>(AEDECOD) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_risk_diff</span>(<span class="fu">c</span>(<span class="st">&#39;Xanomeline Low Dose&#39;</span>, <span class="st">&#39;Placebo&#39;</span>))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">build</span>(t)) <span class="sc">%&gt;%</span> <span class="co"># Chi-squared warnings occur with small samples</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="13%" />
<col width="8%" />
<col width="17%" />
<col width="17%" />
<col width="11%" />
<col width="23%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="left">rdiff_Xanomeline Low Dose_Placebo</th>
<th align="right">ord_layer_1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ACTINIC KERATOSIS</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 (9e-01%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="left">0.000 ( 0.000, 0.000)</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">ALOPECIA</td>
<td align="left">1 ( 2.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="left">-2.1e-02 (-7.7e-02, 3.5e-02)</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">BLISTER</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">2 ( 1.8%)</td>
<td align="left">8 ( 6.8%)</td>
<td align="right">1</td>
<td align="left">6.8e-02 ( 8e-03, 0.128)</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">COLD SWEAT</td>
<td align="left">3 ( 6.4%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="left">-6.4e-02 (-0.149, 2.1e-02)</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">DERMATITIS ATOPIC</td>
<td align="left">1 ( 2.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="right">1</td>
<td align="left">-2.1e-02 (-7.7e-02, 3.5e-02)</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">DERMATITIS CONTACT</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">2 ( 1.7%)</td>
<td align="right">1</td>
<td align="left">1.7e-02 (-2.1e-02, 5.5e-02)</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
<p>Note that the risk-difference variables above have mostly shifted to scientific notation. This is because the limit has been shifted to .1 within the ‘Tplyr’ build.</p>
</div>
<div id="quantile-algorithms" class="section level2">
<h2>Quantile Algorithms</h2>
<p>There are many algorithms available to compute quantile R has 9, controlled by the <code>type</code> parameter in <code>quantile()</code>. The descriptive statistics offer built-in summaries for Q1, Q3, and Interquartile range, all three of which use the <code>quantile()</code> in the underlying implementation. Given that we offer this default, we felt it was important to offer you the flexibility to change the algorithm. You can do this with <code>tplyr.quantile_type</code>.</p>
<p>The default we chose to use is the R default of Type 7:</p>
<p><span class="math display">\[
m = 1-p. p[k] = (k - 1) / (n - 1). \textrm{In this case, } p[k] = mode[F(x[k])]. \textrm{This is used by S.}
\]</span> The example below demonstrates using the default quantile algorithm in R</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tplyr_table</span>(adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_desc</span>(CUMDOSE) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(<span class="st">&quot;Q1, Q3&quot;</span> <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&#39;xxxxx, xxxxx&#39;</span>, q1, q3))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="10%" />
<col width="12%" />
<col width="25%" />
<col width="24%" />
<col width="15%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
<th align="right">ord_layer_index</th>
<th align="right">ord_layer_1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Q1, Q3</td>
<td align="left">0, 0</td>
<td align="left">2646, 13959</td>
<td align="left">1984, 9801</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Within the clinical world, you may wish to match the way that SAS calculates quantiles. To match SAS’s definition, use Type 3:</p>
<p><span class="math display">\[
\textrm{Nearest even order statistic. γ = 0 if g = 0 and  j is even, and 1 otherwise.}
\]</span></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tplyr.quantile_type =</span> <span class="dv">3</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tplyr_table</span>(adsl, TRT01P) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_layer</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_desc</span>(CUMDOSE) <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_format_strings</span>(<span class="st">&quot;Q1, Q3&quot;</span> <span class="ot">=</span> <span class="fu">f_str</span>(<span class="st">&#39;xxxxx, xxxxx&#39;</span>, q1, q3))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">build</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">&quot;ord&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">row_label1</th>
<th align="left">var1_Placebo</th>
<th align="left">var1_Xanomeline High Dose</th>
<th align="left">var1_Xanomeline Low Dose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Q1, Q3</td>
<td align="left">0, 0</td>
<td align="left">2565, 13959</td>
<td align="left">1944, 9774</td>
</tr>
</tbody>
</table>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
